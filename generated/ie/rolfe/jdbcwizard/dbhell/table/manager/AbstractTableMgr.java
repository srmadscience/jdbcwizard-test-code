package ie.rolfe.jdbcwizard.dbhell.table.manager;


import java.sql.*; 
import com.orindasoft.pub.LogInterface; 
import com.orindasoft.pub.LongObjectLoader; 
import com.orindasoft.pub.StatsInterface; 
import com.orindasoft.pub.OracleResourceUser; 
import com.orindasoft.pub.CSException; 
import com.orindasoft.pub.ReadOnlyRowSet; 
/** 
* Abstract table class used by all classes generated by JDBCWizard
* 
* <p>Generated by JDBCWizard build 3145 at 2025/11/14 10:05:49.543 EST
* <p>JDBCWizard is made by <a href="http://www.orindasoft.com/?pdsrc=GD3145" target="_blank">Orinda Software Ltd, Dublin, Ireland</a>
* <p>Target Database: Oracle 12.1.0
* <p> -------------------------------------------------------------------------
* <p> WARNING: This code will stop working around the time JDBCWizard expires.
* <p> This restriction only exists in the demo version of JDBCWizard.
* <p> -------------------------------------------------------------------------
* <p> JDBCWizard Tips 10 of 19:
* <p> JDBCWizard allows you to run complex stored procedures without 
* <p> using a precompiler such as SQLJ
* <p> -------------------------------------------------------------------------
* 
* <p>
* @author rolfe.ie
*/ 
public abstract class AbstractTableMgr implements OracleResourceUser, StatsInterface 
{ 
  /**                                                        
  * Counter for number of Parses - used by StatsInterface    
  * @see StatsInterface  
  */                                                         
  long parseCount = 0;                          
                                                
  /**                                                        
  * Counter for amount of time spent parsing in milliseconds - used by StatsInterface    
  * @see StatsInterface  
  */                                                         
  long parseTimeMilliseconds = 0;                          
                                                
  /**                                                        
  * Counter for number of executions - used by StatsInterface  
  * @see StatsInterface  
  */                             
  long executionCount = 0;                               
                                                       
  /**                                                        
  * Counter for amount of time spent executing - used by StatsInterface  
  * @see StatsInterface  
  */                             
  long executionTimeMilliseconds = 0;                               
                                                       
  /**                                                        
  * Counter for amount of time spent retrieving - used by StatsInterface  
  * @see StatsInterface  
  */                             
  long retrieveTimeMilliseconds = 0;                               
                                                       
  /**                                          
  * Counter for number of Connection Releases - used by StatsInterface  
  * @see StatsInterface  
  */                                                       
  long releaseCount = 0;                              
  
  /**                                          
  * Counter for number of Errors - used by StatsInterface  
  * @see StatsInterface  
  */                                                       
  long errorCount = 0;                              
  
  /**                                          
  * Counter for how long a statement has spent executing or parsing - used by StatsInterface  
  * @see StatsInterface  
  */                                                       
  long statsEventTimer = 0;                              
  
  
  /**
  * Variable to store Buffer Size for file access.
  */
  protected int bufferSize = 4096;
  
  /**
  * Variable to store Long object loader.
  */
  protected LongObjectLoader objectLoader = new LongObjectLoader();
  
  /**
  * bfileGenerator - Create BFILE pointers when needed
  **/
  GenericTableBfileCreator bfileGenerator = null;
  
  /** 
  * Database Connection 
  */ 
  public Connection theConnection = null; 
  
  /** 
  * An instance of a class which implements com.orindasoft.pub.LogInterface 
  */ 
  public com.orindasoft.pub.LogInterface theLog = null; 
  
  /**
  * AbstractTableMgr - Abstract base class for tables
  * @param Connection theConnection
  * @param LogInterface theLog
  **/
  public AbstractTableMgr (Connection theConnection, LogInterface theLog) 
    { 
    this.theConnection = theConnection; 
    this.theLog = theLog; 
    } 
  
  /**
  * Set new file io buffer size
  * @param int bufferSize A new Buffer size in bytes.
  */
  public void setBufferSize(int bufferSize)
    {
    this.bufferSize = bufferSize;
    theLog.debug("bufferSize set to " + bufferSize);
    }
   
  /**
  * createBFILEPointer - Create BFILE Pointer Object
  * @param String bfileDirectoryName
  * @param String bfileFileName
  **/
  public oracle.sql.BFILE createBFILEPointer(String bfileDirectoryName, String bfileFileName) throws CSException
    { 
    if (bfileGenerator == null)
      { 
      bfileGenerator = new GenericTableBfileCreator(theConnection, theLog);
      bfileGenerator.setKeepLobs(true);
      }
     
    bfileGenerator.setParamBfileFileDir(bfileDirectoryName);
    bfileGenerator.setParamBfileFileName(bfileFileName);
    ReadOnlyRowSet bfileRowset = bfileGenerator.executeQuery();
    Object[] theRow = bfileRowset.getCurrentRow();
      
    // Perform a sanity check before reading the array
    if (theRow.length != 1)
      {
      throw new CSException("Unexpected failure in createBFILEPointer: BFILE Array is wrong length");
      }
      
    // If the parameters we gave were for a non-existent directory we'll have returned a CSException
    // instead of an oracle.sql.BFILE
    if (theRow[0] instanceof CSException)
      {
      throw((CSException)theRow[0]);
      }
     
    return((oracle.sql.BFILE)theRow[0]);
    }
  
  /**                                          
  * Start timer used to keep track of parse and execution time - used to implement StatsInterface  
  * @see StatsInterface  
  */                                                       
  public void startStatsTimer()      
    {                                    
    statsEventTimer = System.currentTimeMillis();
    }                         
   
  /**                                          
  * Increment variable used to keep track of retrieval time - used to implement StatsInterface  
  * @see StatsInterface  
  */                                                       
  public void incRetrieveTime()   
    {                               
    retrieveTimeMilliseconds = retrieveTimeMilliseconds + (System.currentTimeMillis() - statsEventTimer);
    statsEventTimer=0;
    }                                
   
  /**                                          
  * Increment counter used to keep track of errors - used to implement StatsInterface  
  * @see StatsInterface  
  */                                                       
  public void incErrorCount()     
    {                                  
    if (errorCount < Long.MAX_VALUE)   
      {                                   
      errorCount++;                  
      }                                    
    else  
      {      
      theLog.syserror("error counter is greater than " + releaseCount);   
      }                          
    } 
  /**                                          
  * Increment counter used to keep track of releases - used to implement StatsInterface  
  * @see StatsInterface  
  */                                                       
  public void incReleaseCount()     
    {                                  
    if (releaseCount < Long.MAX_VALUE)   
      {                                   
      releaseCount++;                  
      }                                    
    else  
      {      
      theLog.syserror("release counter is greater than " + releaseCount);   
      }                          
    } 
   
  } // Generated by JDBCWizard 6.0.3145  
